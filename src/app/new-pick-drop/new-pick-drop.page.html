 <app-header></app-header>
<ion-content [fullscreen]="true">
 

  <div class="page_outer_div">
    <div class="border_div">

      <!-- Banner Swiper -->
      <div class="outer_category_div">
        <swiper-container class="mySwiper" slides-per-view="1" space-between="10" autoplay="false">
          <swiper-slide *ngFor="let item of bannerImg">
            <div class="slide-content">
              <img [src]="item.image_url" alt="">
            </div>
          </swiper-slide>
        </swiper-container>
      </div>

      <!-- Pickup & Drop Section -->
      <div class="pickup_drop_outer_div">
        <div class="heading_pickup">
          <p class="head_p font_weight">Pickup & Drop: Fast, Easy & Convenient</p>
          <p class="sub_head_p">Effortless delivery with real-time tracking.</p>
        </div>

        <!-- Pickup -->
        <p class="label_heading">Pickup Address</p>
        <div class="display_flex">
          <input #pickupInput type="text" placeholder="Enter pickup location" [(ngModel)]="pickupAddress" 
                 (focus)="onInputFocus()" (blur)="onInputBlur()">
          <ion-icon name="location-outline"></ion-icon>
        </div>

        <!-- Drop -->
        <p class="label_heading">Drop Address</p>
        <div class="display_flex">
          <input #dropInput type="text" placeholder="Enter drop location" [(ngModel)]="dropAddress"
                 (focus)="onInputFocus()" (blur)="onInputBlur()">
          <ion-icon name="location-outline"></ion-icon>
        </div>

        <!-- Parcel Details -->
        <div class="parcel_label_div">
          <p class="label_heading">Parcel Items </p> <ion-icon name="information-circle"
            (click)="presentPopover($event)"></ion-icon>
        </div>

      <div *ngFor="let item of items; let i = index" class="add_item_div mb-2">
        <!-- Weight -->
        <input 
          type="number" 
          placeholder="Weight" 
          [(ngModel)]="item.weight" 
          (ngModelChange)="validateWeight(item)" 
          (focus)="onInputFocus()" (blur)="onInputBlur()"
          style="width: 70px; margin-right: 6px;" />

        <!-- Unit -->
        <select 
          class="slect_option" 
          [(ngModel)]="item.unit" 
          (ngModelChange)="validateWeight(item)"
          style="width: 60px; margin-right: 6px;">
          <option value="kg" selected>kg</option>
          <option value="g">g</option>
          <option value="lbs">lbs</option>
        </select>
  
      </div>

        <!-- Distance -->
        <div *ngIf="distanceText" class="distance_info">
          <p><strong>Distance:</strong> {{ distanceText }}</p>
          <p><strong>Duration:</strong> {{ routeDurationText }}</p>
        </div>

        <!-- Comments -->
        <p class="label_heading">Comments</p>
        <textarea class="text_area" [(ngModel)]="parcelComment" placeholder="Enter any special instructions"
                  (focus)="onInputFocus()" (blur)="onInputBlur()"></textarea>

        <!-- Submit -->
        <div>
          <ion-button  class="welcome_submit mt_1" expand="block" (click)="placeOrder()">Submit</ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<ion-popover [isOpen]="isPopoverOpen" (didDismiss)="isPopoverOpen = false">
  <ng-template>
    <div class="popover-content">
      Weight Not More than : <strong>3kg</strong>
    </div>
  </ng-template>
</ion-popover>
<app-footer-tabs *ngIf="!isInputFocused"></app-footer-tabs>

<ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Order Summary</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="isModalOpen = false">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <div class="summary-section pickup">
        <h3>Pickup Address</h3>
        <p>{{ pickupAddress || 'No pickup address specified' }}</p>
      </div>

      <div class="summary-section drop">
        <h3>Drop Address</h3>
        <p>{{ dropAddress || 'No drop address specified' }}</p>
      </div>

      <div class="summary-section items">
        <h3>Parcel Items</h3>
        <div *ngFor="let item of items; let i = index" class="item-card">
          <p><strong>Item {{ i+1 }}</strong></p>
          <p><strong>Weight:</strong> {{ item.weight || '-' }} {{ item.unit }}</p>
        </div>
      </div>

      <div class="summary-section trip">
        <h3>Trip Information</h3>
        <p><strong>Distance:</strong> {{ distanceText || 'Calculating...' }}</p>
        <p><strong>Duration:</strong> {{ routeDurationText || 'Calculating...' }}</p>
      </div>

      <div>
        <div class="arriving_outer_div">
          <div class="arriving_div">
            <p class="font_weight">Arriving in 20 min</p>
            <p  class="text_font">Fast, Easy, and Secure - Complete your purchase</p>
        
            <div class="display_flex_checkbox ">
              <input type="checkbox" [checked]="selectedDelvieryOption === 'today'" (change)="selectOnlyOnedilvery('today',$event)">  
              <div class="delivery_type">
                <label class="font_weight">Today Delivery</label>
                <p class="text_font">Arriving in 20 min</p>
              </div>     
            </div>
            <div class="display_flex_checkbox ">
              <input type="checkbox" [checked]="selectedDelvieryOption === 'nottoday'" (change)="selectOnlyOnedilvery('nottoday',$event)">  
              <div class="delivery_type">
                <label class="font_weight">Select Date and Time</label>
                <p class="text_font">Get your order delivered on your scheduleâ€”choose your date & time</p>
              </div>     
            </div>
            <div class="text_align_center">
              <ion-datetime-button datetime="datetime" [disabled]="selectedDelvieryOption === 'today'"></ion-datetime-button>
            
              <ion-modal [keepContentsMounted]="true">
                <ng-template>
                  <ion-datetime
                    id="datetime"
                    [value]="selectedDateTime"
                    (ionChange)="onDateTimeChange($event)"
                    [disabled]="selectedDelvieryOption === 'today'"
                    [min]="minDateTime">
                  </ion-datetime>
                </ng-template>
              </ion-modal>
            </div>
            <input type="textarea" placeholder="write your comments" [(ngModel)]="scheduledComments"
                   (focus)="onInputFocus()" (blur)="onInputBlur()">
            
          </div>
      </div>
      </div>
    
    


    </ion-content>
     <ion-footer class="modal_footer">
        <div class="charges">
        <h2>Total Charges: ${{ calculateCharges() }}</h2>
      </div>

      <ion-button expand="block" class="submit_btn" (click)="submitOrder()">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Confirm Order
      </ion-button>
     </ion-footer>
  </ng-template>
</ion-modal>