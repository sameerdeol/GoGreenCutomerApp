<ion-content fullscreen (ionScroll)="onScroll($event)">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-content">
      <ion-spinner name="crescent" color="success"></ion-spinner>
      <p class="loading-text">Loading store products...</p>
    </div>
  </div>

  <!-- Main Content - Show when not loading -->
  <div *ngIf="!isLoading">
    <!-- Fixed Header with Background Image -->
    <div *ngIf="vendorDetails" class="header_bg_img" 
      [class.collapsed]="isHeaderCollapsed"
      [ngStyle]="{'background-image': 'url(' + vendorDetails.store_image + ')'}">
      <div class="page_outer_div">
        <div class="display_flex align_items_center">
          <div class="left_arrow_div">
            <ion-icon name="chevron-back-outline" (click)="goback()"></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Sticky Store Details Section -->
    <div class="sticky-header" [class.collapsed]="isHeaderCollapsed">
      <div class="main_content">
        <!-- Combined Sticky Section: Vendor Details + Filters -->
        <div class="sticky-combined-section bg-white">
          <!-- Vendor Details -->
          <div *ngIf="vendorDetails" class="mb-3">
            <div class="restrao_details">
              <div class="store_basix_details">
                <div class="store_heading">
                  <h2 class="mb-1">{{vendorDetails.store_name}}</h2>
                </div>
                <div class="d-flex align-items-center mb-1">
                  <ion-icon name="location-outline" class="me-1"></ion-icon> 
                  <span class="text-muted">{{vendorDetails.store_address}} </span>
                </div>
                <div class="d-flex align-items-center">
                  <img src="assets/timer-icon.svg" alt="" class="me-1">
                  <p class="mb-0" [ngClass]="{
                    'text_gogreen': vendorDetails.is_vendor_opened,
                    'text-danger': !vendorDetails.is_vendor_opened
                  }">
                    {{ vendorDetails.is_vendor_opened ? 'Open now' : 'Closed' }}
                    (Closes at {{ vendorDetails.vendor_close_time }})
                  </p>
                </div>
              </div>
              <div class="store_basix_details_rating d-flex align-items-center">
                <span class="me-1">3.5</span> <ion-icon name="star"></ion-icon>
              </div>
            </div>
          </div>

          <!-- Filters Section -->
          <div class="main_content_body mt-3">
            <div class="share_bookmark_bar">
              <ion-icon class="color_black font-24" (click)="shareContent()" name="share-social-outline"></ion-icon>
              <div (click)="toggleFav(vendorDetails); $event.stopPropagation()" class="bookmark-btn m-0">
                <ion-icon class="text_gogreen bookmark-filled"
                  [name]="vendorDetails.is_favourite == 1 ? 'bookmark' : 'bookmark-outline'"></ion-icon>
              </div>
            </div>

            <swiper-container class="mySwiper" slides-per-view="2.5" space-between="5" autoplay="false" [breakpoints]="{
              '640': { 'slidesPerView': 5, 'spaceBetween': 5 },
              '768': { 'slidesPerView': 5, 'spaceBetween': 5 },
              '1024': { 'slidesPerView': 5, 'spaceBetween': 5 }
            }">
        <!-- Static Filters Slide -->
        <swiper-slide (click)="selectFilter('Filters')"
          [ngClass]="{'active-slide': selectedFilters.includes('Filters')}">
          <div class="slide-content filter_slide" [ngClass]="{'active_filter_slide': selectedFilterCount > 0}">
            <p class="m-0"><ion-icon name="options-outline"></ion-icon>Filters <span
                *ngIf="selectedFilterCount > 0">{{selectedFilterCount}}</span></p>
          </div>
        </swiper-slide>

        <!-- Dynamic Filter Slides -->
        <swiper-slide *ngFor="let cat1 of filters">
          <div class="slide-content filter_slide" [ngClass]="{'active-slide': selectedFilters.includes(cat1)}"
            (click)="toggleSlideFilter(cat1)">
            <span>{{ cat1 }}</span>
            <ion-icon *ngIf="selectedFilters.includes(cat1)" name="close" class="filter-close"
              (click)="removeSlideFilter($event, cat1)">
            </ion-icon>
          </div>
        </swiper-slide>
            </swiper-container>
          </div>
        </div>

        <!-- Scrollable Products Section -->
        <div class="products-content">
          <ion-list>
        <ion-item class="mb-3 mt-3 product-row" lines="none" *ngFor="let product of allProducts" >
          <div slot="start" class="product_img_div">
            <div class="product_img_div_box">
              <img [src]="product.featured_image" (click)="navigateToProduct(product)" />

            </div>
            <div class="pro_qyt_buttons">
              <div class=" custm_padding" *ngIf="!isAddedMap[product.id]; else quantityControls">
                <button class="add_to_cart_btn_bg" (click)="addToCart(product)">ADD</button>
              </div>
            </div>
          </div>

          <ng-template #quantityControls>
            <div class="custm_padding">
              <button class="add_to_cart_btn_bg2">
                <span class="remove_item_btn" (click)="removeFromCart(product)">-</span>
                <span>{{ getQuantity(product.id) }}</span>
                <span class="add_item_btn" (click)="addToCart(product)">+</span>
              </button>
            </div>
          </ng-template>

          <div class="product-info-col" (click)="navigateToProduct(product)">
            <h2>{{product.name}}</h2>
            <p>{{product.description}}</p>

            <div class="pro_qyt_box">
              <div class="pro_qyt_price">
                <h3 class="color_black font-weight-bold margin_0">{{currency}}{{ product.price }}</h3>
              </div>

            </div>

          </div>
        </ion-item>
      </ion-list>

          </div> <!-- Close products-content -->
      </div> <!-- Close main_content -->
    </div> <!-- Close sticky-header -->
  </div> <!-- Close main wrapper -->
  
  <div class="view_cart_div" *ngIf="showViewCart && !isLoading" (click)="navigateToOrders()">
    <p class="margin_0">
    {{ cartQuantity }} {{ cartQuantity > 1 ? 'items' : 'item' }} added
  </p>
  <ion-icon name="arrow-forward"></ion-icon>
  </div>
</ion-content>


<div class="search_outer_div">
  <ion-searchbar class="Vendor_product_search" (ionFocus)="openSearchModal()"></ion-searchbar>
  <ion-button fill="clear" class="cart-button" (click)="navigateToOrders()">

    <img src="/assets/cart.svg" alt="Cart" class="cart-img animate__animated"
      [ngClass]="{ 'animate__tada': animateCart }" (animationend)="animateCart = false" />
    <ion-badge class="cart_badge" *ngIf="cartQuantity > 0">{{cartQuantity}}</ion-badge>
  </ion-button>
</div>