<app-common-header></app-common-header>
<ion-content [fullscreen]="true">

  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="arrow-down"
      pullingText="Pull to refresh"
      refreshingSpinner="circles"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="page_outer_div">

    <!-- Category Switch -->
    <div class="filter_header">
      <ion-segment mode="md" [(ngModel)]="selectedCategory">
        <ion-segment-button value="shop">
          <ion-icon name="bag-handle-outline"></ion-icon>
          <ion-label>Shop Orders</ion-label>
        </ion-segment-button>
        <ion-segment-button value="pickdrop">
          <ion-icon name="swap-vertical-outline"></ion-icon>
          <ion-label>Pick & Drop</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Status Filters -->
    <div class="filter_header">
      <swiper-container class="mySwiper" slides-per-view="2.5" space-between="5" autoplay="false" [breakpoints]="{
        '640': { 'slidesPerView': 5, 'spaceBetween': 5 },
        '768': { 'slidesPerView': 5, 'spaceBetween': 5 },
        '1024': { 'slidesPerView': 5, 'spaceBetween': 5 }
      }">
        <swiper-slide *ngFor="let filter of filters" (click)="OnFilterClick(filter)">
          <div class="slide-content filter_slide" [class.active]="selectedFilter === filter">
            <span>{{ filter }}</span>
          </div>
        </swiper-slide>
      </swiper-container>
    </div>

    <!-- Orders (Normal + Pick & Drop) -->
    <ng-container *ngIf="filteredOrders.length > 0; else noOrdersTemplate">
      <ion-card *ngFor="let order of filteredOrders" class="order_card">
        <!-- Header -->
        <ion-card-header class="card_header">
          <div class="header_inner_div">
            <ion-card-subtitle>{{order.order_uid}}</ion-card-subtitle>
            <div *ngIf="order.orderType === 'normal'" class="chip" [ngClass]="{
                'chip--pending': order.order_status === 0,
                'chip--confirmed': order.order_status === 1,
                'chip--out': order.order_status === 2,
                'chip--cancelled': order.order_status === 3
              }">
              {{ getOrderStatusText(order.order_status) }}
            </div>
            <div class="chip chip--pickdrop" *ngIf="order.orderType === 'pickdrop'">
              <ion-icon name="bicycle-outline"></ion-icon>
              <span>Pick & Drop</span>
            </div>
          </div>
        </ion-card-header>

        <!-- Normal Orders UI -->
        <ng-container *ngIf="order.orderType === 'normal'">
          <div class="order_top_row">
            <!-- Single Product -->
            <ng-container *ngIf="order.products.length === 1">
              <img [src]="order.products[0].featured_image"
                   alt="{{ order.products[0].product_name }}"
                   class="single-product-image" />
            </ng-container>

            <!-- Multiple Products -->
            <ng-container *ngIf="order.products.length > 1">
              <div class="image_grid_2col">
                <img [src]="order.products[0].featured_image"
                     alt="{{ order.products[0].product_name }}"
                     class="grid-image" />

                <div class="image_wrapper">
                  <img [src]="order.products[1].featured_image"
                       alt="{{ order.products[1].product_name }}"
                       class="grid-image" />
                  <div class="extra_count" *ngIf="order.products.length > 2">
                    +{{ order.products.length - 2 }}
                  </div>
                </div>
              </div>
            </ng-container>

            <!-- Product Info -->
            <div class="product_info">
              <div class="product_name">{{ order.products[0].product_name }}</div>
              <div class="order_meta">
                {{ order.products.length }} items â€¢ Ordered {{ order.created_at | date:'M/d/yyyy' }}
              </div>
              <div class="order_price">${{ order.total_price }}</div>
            </div>
          </div>
        </ng-container>

        <!-- Pick & Drop UI -->
        <ng-container *ngIf="order.orderType === 'pickdrop'">
          <div class="order_top_row">
            <div class="product_info" style="width: 100%">
              <div class="product_name">Pick & Drop</div>
              <div class="pd-row">
                <ion-icon name="arrow-up-circle-outline"></ion-icon>
                <span>{{ order.pickup?.address || order.pickup }}</span>
              </div>
              <div class="pd-row">
                <ion-icon name="arrow-down-circle-outline"></ion-icon>
                <span>{{ order.drop?.address || order.drop }}</span>
              </div>
              <div class="pd-meta">
                <ion-icon name="time-outline"></ion-icon>
                <span>Ordered {{ order.created_at | date:'M/d/yyyy' }}</span>
              </div>
              <div class="pd-price" *ngIf="order.total_price">
                <ion-icon name="cash-outline"></ion-icon>
                <span>${{ order.total_price }}</span>
              </div>
              <div class="card_footer">
                <div class="footer_btn active_footer_btn" (click)="onClickPickDropDetails(order)">Details</div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Footer -->
        <div class="card_footer" *ngIf="order.orderType === 'normal'">
          <div class="footer_btn" (click)="onClickViewDetails(order)">View Details</div>
        </div>
      </ion-card>
    </ng-container>

    <!-- Empty state -->
    <ng-template #noOrdersTemplate>
      <div class="no-orders">
        <!-- <img src="assets/no-orders.png" alt="No Orders" class="no-orders-img" /> -->
        <p *ngIf="selectedFilter === 'All Orders'">No orders found</p>
        <p *ngIf="selectedFilter === 'Delivered'">No delivered orders yet</p>
        <p *ngIf="selectedFilter === 'Cancelled'">No cancelled orders</p>
        <p *ngIf="selectedFilter === 'Pending'">No pending orders</p>
      </div>
    </ng-template>

  </div>
</ion-content>
