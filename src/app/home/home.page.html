<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="refreshPage($event)">
    <ion-refresher-content pullingIcon="arrow-down" pullingText="Pull to refresh" refreshingSpinner="circles"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <app-header></app-header>

  <div class="page_outer_div main_content mb-6rem">
    <app-global-search  (searchFocus)="onSearchFocusChange($event)"></app-global-search>
    <!-- ---- -->



    <!-- Categories -->
    <div *ngIf="!hideDiv">
      <div class="outer_category_div">
        <swiper-container #storeSwiper *ngIf="!isLoading" class="mySwiper" slides-per-view="4" space-between="10"
          [breakpoints]="{
          '640': { 'slidesPerView': 6, 'spaceBetween': 10 },
          '768': { 'slidesPerView': 6, 'spaceBetween': 10 },
          '1024': { 'slidesPerView': 8, 'spaceBetween': 10 }
        }">
          <swiper-slide (click)="onCategorySelect(0,0)" class="main_vendor_types">
            <div class="slide-content" [ngClass]="{ 'active-slide': selectedCategoryIndex === 0 }">
              <div class="icon-circle">
                <img src="assets/all-cat.svg" alt="All" class="svg-icon-static" />
                <p>All Categories</p>
              </div>
            </div>
          </swiper-slide>
          <swiper-slide *ngFor="let item of categories; let i = index" (click)="onCategorySelect(i + 1, item)"
            class="main_vendor_types">
            <div class="slide-content" [ngClass]="{ 'active-slide': selectedCategoryIndex === i + 1 }">
              <div class="icon-circle">
                <img [src]="item.vendor_type_image" alt="{{ item.vendor_type }}" class="svg-icon" />
                <p>{{ item.vendor_type }}</p>
              </div>
            </div>
          </swiper-slide>
        </swiper-container>

        <div class="d-flex" *ngIf="isLoading">
          <div class="shimmer" *ngFor="let i of [1,2,3,4]"
            style="width: 250px; height: 85px; border-radius: 5px; margin: 10px 6px;"></div>
        </div>

      </div>
        <div class="outer_category_div"> 
        <swiper-container class="mySwiper" slides-per-view="1" space-between="10" autoplay="true">
          <swiper-slide *ngFor="let item of bannerImg">
            <div class="slide-content">
              <img class="banner_img" [src]="item.image_url" alt="" >
            </div>
          </swiper-slide>
        </swiper-container>
      </div>
      <div class="vendorsOuterDiv" *ngIf="!noVendorsFound && !isLoading">
        <!-- End Groceries SUb CAtegories --- -->
        <div class="recomender_heading">Recommended For You</div>
        <div class="Recomended_vendor_div home_vendor_swiper_slides">
          <div class="vendors-scroll-container">
            <div class="vendors-grid">
              <div *ngFor="let item of Allvendors; let i = index" class="vendor-card"
                (click)="handleVendorClick(i, item)" (mouseenter)="onVendorHover(i, true)"
                (mouseleave)="onVendorHover(i, false)" (touchstart)="onVendorTouch(i)"
                [class.hovering]="hoveredVendorIndex === i">

                <div class="vendor-image-wrapper">
                  <!-- Image Stack for Carousel Effect -->
                  <div class="image-stack">
                    <img *ngFor="let img of getVendorImages(item); let imgIndex = index" [src]="img" alt="vendor image"
                      class="vendor-image" [style.opacity]="getVendorImageOpacity(i, imgIndex)"
                      [style.transform]="getVendorImageTransform(i, imgIndex)"
                      [style.z-index]="getCurrentVendorImageIndex(i) === imgIndex ? 2 : 1" />
                  </div>

                  <!-- Dots Pagination (only show if multiple images) -->
                  <div class="dots-pagination" *ngIf="item?.featured_images?.length > 1">
                    <span *ngFor="let img of item.featured_images; let dotIndex = index" class="dot"
                      [class.active]="getCurrentVendorImageIndex(i) === dotIndex">
                    </span>
                  </div>

                  <!-- Favorite Heart Icon -->
                  <div class="favorite-icon">                
                     <button fill="clear" (click)="toggleFav(item); $event.stopPropagation()"
                        class="bookmark-btn m-0 book_mark_button">
                        <ion-icon class="text_gogreen bookmark-filled"
                          [name]="item?.is_favourite == 1 ? 'bookmark' : 'bookmark-outline'">
                        </ion-icon>
                      </button>
                  </div>
                </div>

                <div class="vendor-info">
                  <h3 class="vendor-name">{{ item.store_name }}</h3>
                  <p class="delivery-time">
                     <img src="assets/timer-icon.svg" alt="">
                    20-30 mins
                  </p>

                  <!-- Additional vendor info if available -->
                  <div class="vendor-details" *ngIf="item.rating || item.delivery_fee">
                    <span class="rating" *ngIf="item.rating">
                      <ion-icon name="star"></ion-icon>
                      {{ item.rating }}
                    </span>
                    <span class="delivery-fee" *ngIf="item.delivery_fee">
                      {{ currency }}{{ item.delivery_fee }} delivery
                    </span>
                  </div>

                  <!-- Vendor tags/categories -->
                  <div class="vendor-tags" *ngIf="item.categories?.length">
                    <span class="tag" *ngFor="let category of item.categories.slice(0, 2)">
                      {{ category.name }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ðŸ›ï¸ All Vendors -->
        <!-- All Stores Section with Image Carousel -->
        <div class="features_product_div" *ngIf="Allvendors && Allvendors.length > 0">
          <div class="slider_heading_div">
            <h3>All Stores</h3>
          </div>

          <ion-card *ngFor="let item of Allvendors; let i = index"
            class="mb-3 home_vendor_card_box vendor-card-with-carousel" (click)="handleVendorClick(i, item)"
            (mouseenter)="onVendorHover(i, true)" (mouseleave)="onVendorHover(i, false)"
            (touchstart)="onVendorTouch(i)">

            <!-- Bookmark/Favorite Button -->
            <div class="bookmark_outer_div">
              <button fill="clear" (click)="toggleFav(item); $event.stopPropagation()"
                class="bookmark-btn m-0 book_mark_button">
                <ion-icon class="text_gogreen bookmark-filled"
                  [name]="item?.is_favourite == 1 ? 'bookmark' : 'bookmark-outline'">
                </ion-icon>
              </button>
            </div>

            <!-- Image Carousel Container -->
            <div class="vendor-image-carousel-container w-100 vendor_slider home_all_vendor_big_box">
              <!-- Image Stack for Carousel Effect -->
              <div class="store-image-stack">
                <img *ngFor="let img of getVendorImages(item); let imgIndex = index" [src]="img"
                  alt="vendor store image" class="vendor_store_img box_vendor_images store-carousel-image"
                  [style.opacity]="getVendorImageOpacity(i, imgIndex)"
                  [style.transform]="getVendorImageTransform(i, imgIndex)"
                  [style.z-index]="getCurrentVendorImageIndex(i) === imgIndex ? 2 : 1" />
              </div>

              <!-- Dots Pagination (only show if multiple images) -->
              <div class="store-dots-pagination" *ngIf="item?.featured_images?.length > 1">
                <span *ngFor="let img of item.featured_images; let dotIndex = index" class="store-pagination-dot"
                  [class.active]="getCurrentVendorImageIndex(i) === dotIndex">
                </span>
              </div>

            </div>

            <!-- Store Information -->
            <ion-card-header class="vendor_text_box">
              <div class="d-flex align-items-center justify-content-between">
                <div class="font-weight-bold vendor-heading-primary">{{ item.store_name }}</div>
                <div class="vendor_rating">
                  {{ item.rating || '3.9' }}
                  <ion-icon class="text-white" name="star"></ion-icon>
                </div>
              </div>
              <div class="d-flex align-items-center">
                <img src="assets/timer-icon.svg" alt="">
                <p class="mb-0 font-weight-bold text-gray">
                  {{ item.vendor_start_time }}AM - {{ item.vendor_close_time }}PM
                </p>
              </div>
            </ion-card-header>
          </ion-card>
        </div>
      </div>

      <div *ngIf="isLoading">
        <div class="recomender_heading">
          <ion-skeleton-text animated style="width: 200px; height: 20px;"></ion-skeleton-text>
        </div>

        <div class="Recomended_vendor_div_skeleton home_vendor_swiper_slides">
          <div class="skeleton-card" *ngFor="let s of [1,2]">
            <ion-skeleton-text animated style="width: 180px; height: 180px; border-radius: 8px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 100px; height: 16px; margin-top: 8px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 60px; height: 14px; margin-top: 4px;"></ion-skeleton-text>
          </div>
        </div>

        <div class="slider_heading_div">
          <ion-skeleton-text animated style="width: 150px; height: 20px;"></ion-skeleton-text>
        </div>

        <div class="skeleton-card" *ngFor="let s of [1,2]">
          <ion-skeleton-text animated style="width: 100%; height: 200px; border-radius: 6px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 120px; height: 16px; margin-top: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 80px; height: 14px; margin-top: 4px;"></ion-skeleton-text>
        </div>
      </div>

      <div class="no-vendors" *ngIf="noVendorsFound">
        <img src="assets/NoStoreFound.webp" alt="No vendors found" class="no-vendors-img" />
        <p>No Vendors Found </p>
      </div>
    </div>

  </div>
</ion-content>
<app-footer-tabs></app-footer-tabs>